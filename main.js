(()=>{"use strict";function t(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",(function(t){n(t)}))}function e(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",(function(t){n(t)}))}function n(t){"Escape"===t.key&&e(document.querySelector(".popup_is-opened"))}var o={baseUrl:"https://nomoreparties.co/v1/cohort-mag-4",headers:{authorization:"b39de8ea-6873-4606-b10b-695abf431d72","Content-Type":"application/json"}},r=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r={method:t,headers:o.headers};return n&&Object.keys(n).length>0&&(r.body=JSON.stringify(n)),fetch("".concat(o.baseUrl).concat(e),r).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))};function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,i=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),c=i.querySelector(".card__image"),u=i.querySelector(".card__like-block_button"),a=i.querySelector(".card__like-block_counter"),l=i.querySelector(".card__delete-button"),s=t.name,d=t.link;return c.src=d,c.alt=s,i.querySelector(".card__title").textContent=s,t.likes.find((function(e){t.owner._id}))&&u.classList.toggle(".card__like-block_button_is-active"),e===t.owner._id&&function(t){t.classList.add(".card__delete-button_is-active.css")}(l),a.textContent=t.likes.length,l.addEventListener("click",(function(){n(l,t._id)})),c.addEventListener("click",(function(){o(s,d)})),u.addEventListener("click",(function(){r(u,a,e)})),i}function c(t,e,n){(t.classList.contains(".card__like-block_button_is-active")?function(t){return r("DELETE","/cards/likes/".concat(t))}(n):function(t){return r("PUT","/cards/likes/".concat(t))}(n)).then((function(n){!function(t,e,n){e.textContent=n.length,t.classList.contains("card__like-block_button_is-active")?t.classList.remove("card__like-block_button_is-active"):t.classList.add("card__like-block_button_is-active")}(t,e,n.likes)})).catch((function(t){return console.log(t)})).fimally((function(){return t.disabled=!1}))}function u(t,e){(function(t){return r("DELETE","/cards/".concat(t))})(e).then((function(){t.closest(".place__item").remove()})).catch((function(t){return console.log(t)}))}function a(t){var e=t.formElement,n=t.inputElement,o=t.inputErrorClass,r=t.errorClass,i=e.querySelector(".".concat(n.id,"-error"));n.classList.remove(o),i.classList.remove(r),i.textContent=""}function l(t){var e=t.inputList,n=t.submitButtonElement,o=t.inactiveButtonClass;!function(t){return t.some((function(t){return!t.validity.valid}))}(e)?(n.disable=!1,n.classList.remove(o)):(n.disable=!0,n.classList.add(o))}var s,d,p,m,f,_,v,y={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},E=document.querySelector(".places__list"),b=document.querySelector(".popup_type_edit"),C=document.querySelector(".popup_type_new-card"),S=document.querySelector(".popup_type_image"),k=document.querySelectorAll(".popup"),h=document.querySelector(".popup__image"),L=document.querySelector(".popup__caption"),q=document.querySelector(".profile__edit-button"),g=document.querySelector(".profile__add-button"),B=document.querySelector(".profile__info"),x=B.querySelector(".profile__title"),T=B.querySelector(".profile__description"),A=document.querySelector(".profile__image"),w=document.forms["edit-profile"],D=w.name,P=w.description,M=w.querySelector(".button"),j=document.forms["edit-avatar"],O=j.querySelector(".popup__button"),U=j.avatar,G=document.querySelector(".popup_typt_edit-avatar"),H=(document.forms["delete-card"],document.querySelector(".popup_type_confirm").querySelector(".popup__close"),document.forms["new-place"]),N=H["place-name"],V=H.link,z=H.querySelector(".popup__button");function I(t,e){t.textContent=e?"Сохранение...":"Сохранить"}function J(t,e,n){x.textContent=t,T.textContent=e,A.style.backgroundImage="url(".concat(n,")")}function F(e,n){h.src=n,h.alt=e,L.textContent=e,t(S)}G.addEventListener("click",(function(){var e,n,o,r,i,c,u,s,d;j.reset(),e=j,o=(n=y).inputSelector,r=n.submitButtonSelector,i=n.inactiveButtonClass,c=n.inputErrorClass,u=n.errorClass,s=Array.from(e.querySelectorAll(o)),d=e.querySelector(r),s.forEach((function(t){a({formElement:e,inputElement:t,inputErrorClass:c,errorClass:u})})),l({inputList:s,submitButtonElement:d,inactiveButtonClass:i}),t(G)})),g.addEventListener("click",(function(){t(C)})),q.addEventListener("click",(function(){P.value=T.textContent,D.value=x.textContent,t(b)})),j.addEventListener("submit",(function(t){!function(t){var n;t.preventDefault(),I(O,!0),(n={avatar:U.value},r("PATCH","/users/me/avatar",{avatar:n})).then((function(t){J(t.name,t.about,t.avatar),e(G),j.reset()})).catch((function(t){console.log(t)})).finally((function(){I(O,!1)}))}(t)})),w.addEventListener("submit",(function(t){!function(t){var n,o,i;t.preventDefault(),I(M,!0),(n={name:D.value,about:P.value},o=n.name,i=n.about,r("PATCH","/users/me",{name:o,about:i})).then((function(t){J(t.name,t.about,t.avatar),e(b),w.reset()})).catch((function(t){console.log(t)})).finally((function(){I(M,!1)}))}(t)})),H.addEventListener("submit",(function(t){!function(t){var n,o,a;t.preventDefault(),I(z,!0),(n={name:N.value,link:V.value},o=n.name,a=n.link,r("POST","/cards",{name:o,link:a})).then((function(t){E.prepend(i(t,t.owner._id,u,F,c)),e(C),H.reset()})).catch((function(t){console.log(t)})).finally((function(){I(z,!1)}))}(t)})),k.forEach((function(t){t.classList.add("popup_is-animated"),t.querySelector(".popup__close").addEventListener("click",(function(){e(t)})),t.addEventListener("mousedown",(function(n){!function(t,n){t.target===t.currentTarget&&e(n)}(n,t)}))})),d=(s=y).formSelector,p=s.inputSelector,m=s.submitButtonSelector,f=s.inactiveButtonClass,_=s.inputErrorClass,v=s.errorClass,Array.from(document.querySelectorAll(d)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t){var e=t.formElement,n=t.inputSelector,o=t.submitButtonSelector,r=t.inactiveButtonClass,i=t.inputErrorClass,c=t.errorClass,u=Array.from(e.querySelectorAll(n)),s=e.querySelector(o);l({inputList:u,submitButtonElement:s,inactiveButtonClass:r}),u.forEach((function(t){t.addEventListener("input",(function(){!function(t){var e=t.formElement,n=t.inputElement,o=t.inputErrorClass,r=t.errorClass;n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?a({formElement:e,inputElement:n,inputErrorClass:o,errorClass:r}):function(t){var e=t.inputElement,n=t.inputErrorClass,o=t.errorClass,r=t.errorMessage,i=t.formElement.querySelector(".".concat(e.id,"-error"));i.textContent=r,e.classList.add(n),i.classList.add(o)}({formElement:e,inputElement:n,inputErrorClass:o,errorClass:r,errorMessage:n.validationMessage})}({formElement:e,inputElement:t,inputErrorClass:i,errorClass:c}),l({inputList:u,submitButtonElement:s,inactiveButtonClass:r})}))}))}({formElement:t,inputSelector:p,submitButtonSelector:m,inactiveButtonClass:f,inputErrorClass:_,errorClass:v})})),Promise.all(r("GET","/users/me"),r("GET","/cards")).then((function(t,e){J(t.name,t.about,t.avatar),e.forEach((function(e){E.append(i(e,t._id,u,F,c))}))})).catch((function(t){console.log(t)}))})();