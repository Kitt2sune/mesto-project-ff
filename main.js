(()=>{"use strict";function t(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",(function(t){n(t)}))}function e(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",(function(t){n(t)}))}function n(t){"Escape"===t.key&&e(document.querySelector(".popup_is-opened"))}var o,r,i={baseUrl:"https://nomoreparties.co/v1/cohort-mag-4",headers:{authorization:"b39de8ea-6873-4606-b10b-695abf431d72","Content-Type":"application/json"}},c=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o={method:t,headers:i.headers};return n&&Object.keys(n).length>0&&(o.body=JSON.stringify(n)),fetch("".concat(i.baseUrl).concat(e),o).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))};function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,c=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0,a=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),l=a.querySelector(".card__image"),s=a.querySelector(".card__like-block_button"),d=a.querySelector(".card__like-block_counter"),p=a.querySelector(".card__delete-button"),m=e.name,f=e.link;return l.src=f,l.alt=m,a.querySelector(".card__title").textContent=m,e.likes.find((function(t){e.owner._id}))&&s.classList.toggle(".card__like-block_button_is-active"),n===e.owner._id&&function(e,n){e.classList.add(".card__delete-button_is-active"),e.addEventListener("click",(function(){t(popupConfirm),r=n,o=e}))}(p,e._id),d.textContent=e.likes.length,p.addEventListener("click",(function(){i(p,e._id)})),l.addEventListener("click",(function(){c(m,f)})),s.addEventListener("click",(function(){u(s,d,n)})),a}function a(t,e,n){(t.classList.contains(".card__like-block_button_is-active")?function(t){return c("DELETE","/cards/likes/".concat(t))}(n):function(t){return c("PUT","/cards/likes/".concat(t))}(n)).then((function(n){!function(t,e,n){e.textContent=n.length,t.classList.contains(".card__like-block_button_is-active")?t.classList.remove(".card__like-block_button_is-active"):t.classList.add(".card__like-block_button_is-active")}(t,e,n.likes)})).catch((function(t){return console.log(t)})).finally((function(){return t.disabled=!1}))}function l(t){var n;t.preventDefault(),(n=r,c("DELETE","/cards/".concat(n))).then((function(){o.closest(".place__item").remove(),e(popupConfirm)})).catch((function(t){return console.log(t)}))}function s(t){var e=t.formElement,n=t.inputElement,o=t.inputErrorClass,r=t.errorClass,i=e.querySelector(".".concat(n.id,"-error"));n.classList.remove(o),i.classList.remove(r),i.textContent=""}function d(t){var e=t.inputList,n=t.submitButtonElement,o=t.inactiveButtonClass;!function(t){return t.some((function(t){return!t.validity.valid}))}(e)?(n.disable=!1,n.classList.remove(o)):(n.disable=!0,n.classList.add(o))}function p(t,e){var n=e.inputSelector,o=e.submitButtonSelector,r=e.inactiveButtonClass,i=e.inputErrorClass,c=e.errorClass,u=Array.from(t.querySelectorAll(n)),a=t.querySelector(o);u.forEach((function(e){s({formElement:t,inputElement:e,inputErrorClass:i,errorClass:c})})),d({inputList:u,submitButtonElement:a,inactiveButtonClass:r})}var m,f,_,v,E,y,b,C={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},S=document.querySelector(".places__list"),k=document.querySelector(".popup_type_edit"),L=document.querySelector(".popup_type_edit-avatar"),h=document.querySelector(".popup_type_new-card"),q=document.querySelector(".popup_type_image"),g=document.querySelector(".popup_type_confirm"),B=document.querySelectorAll(".popup"),x=document.querySelector(".popup__image"),T=document.querySelector(".popup__caption"),A=document.querySelector(".profile__edit-button"),w=document.querySelector(".profile__add-button"),D=document.querySelector(".profile__info"),P=D.querySelector(".profile__title"),M=D.querySelector(".profile__description"),j=document.querySelector(".profile__image"),O=document.forms["edit-profile"],U=O.name,G=O.description,H=O.querySelector(".button"),N=document.forms["edit-avatar"],V=N.querySelector(".popup__button"),z=N.avatar,I=document.forms["new-place"],J=I["place-name"],F=I.link,K=I.querySelector(".popup__button"),Q=document.forms["delete-card"];function R(t,e,n){P.textContent=t,M.textContent=e,j.style.backgroundImage="url(".concat(n,")")}function W(t,e){t.textContent=e?"Сохранение...":"Сохранить"}function X(e,n){x.src=n,x.alt=e,T.textContent=e,t(q)}j.addEventListener("click",(function(){N.reset(),p(N,C),t(L)})),w.addEventListener("click",(function(){I.reset(),p(I,C),t(h)})),A.addEventListener("click",(function(){G.value=M.textContent,U.value=P.textContent,t(k)})),N.addEventListener("submit",(function(t){!function(t){var n;t.preventDefault(),W(V,!0),(n={avatar:z.value},c("PATCH","/users/me/avatar",{avatar:n})).then((function(t){R(t.name,t.about,t.avatar),e(L),N.reset()})).catch((function(t){console.log(t)})).finally((function(){W(V,!1)}))}(t)})),O.addEventListener("submit",(function(t){!function(t){var n,o,r;t.preventDefault(),W(H,!0),(n={name:U.value,about:G.value},o=n.name,r=n.about,c("PATCH","/users/me",{name:o,about:r})).then((function(t){R(t.name,t.about,t.avatar),e(k),O.reset()})).catch((function(t){console.log(t)})).finally((function(){W(H,!1)}))}(t)})),I.addEventListener("submit",(function(t){!function(t){var n,o,r;t.preventDefault(),W(K,!0),(n={name:J.value,link:F.value},o=n.name,r=n.link,c("POST","/cards",{name:o,link:r})).then((function(t){S.prepend(u(t,t.owner._id,l,X,a)),e(h),I.reset()})).catch((function(t){console.log(t)})).finally((function(){W(K,!1)}))}(t)})),Q.addEventListener("submit",(function(e){!function(e){l(e),t(g)}(e)})),B.forEach((function(t){t.classList.add("popup_is-animated"),t.querySelector(".popup__close").addEventListener("click",(function(){e(t)})),t.addEventListener("mousedown",(function(n){!function(t,n){t.target===t.currentTarget&&e(n)}(n,t)}))})),f=(m=C).formSelector,_=m.inputSelector,v=m.submitButtonSelector,E=m.inactiveButtonClass,y=m.inputErrorClass,b=m.errorClass,Array.from(document.querySelectorAll(f)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t){var e=t.formElement,n=t.inputSelector,o=t.submitButtonSelector,r=t.inactiveButtonClass,i=t.inputErrorClass,c=t.errorClass,u=Array.from(e.querySelectorAll(n)),a=e.querySelector(o);d({inputList:u,submitButtonElement:a,inactiveButtonClass:r}),u.forEach((function(t){t.addEventListener("input",(function(){!function(t){var e=t.formElement,n=t.inputElement,o=t.inputErrorClass,r=t.errorClass;n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?s({formElement:e,inputElement:n,inputErrorClass:o,errorClass:r}):function(t){var e=t.inputElement,n=t.inputErrorClass,o=t.errorClass,r=t.errorMessage,i=t.formElement.querySelector(".".concat(e.id,"-error"));i.textContent=r,e.classList.add(n),i.classList.add(o)}({formElement:e,inputElement:n,inputErrorClass:o,errorClass:r,errorMessage:n.validationMessage})}({formElement:e,inputElement:t,inputErrorClass:i,errorClass:c}),d({inputList:u,submitButtonElement:a,inactiveButtonClass:r})}))}))}({formElement:t,inputSelector:_,submitButtonSelector:v,inactiveButtonClass:E,inputErrorClass:y,errorClass:b})})),Promise.all(c("GET","/users/me"),c("GET","/cards")).then((function(t,e){R(t.name,t.about,t.avatar),e.forEach((function(e){S.append(u(e,t._id,l,X,a))}))})).catch((function(t){console.log(t)}))})();